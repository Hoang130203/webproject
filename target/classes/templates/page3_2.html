<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<link rel='shortcut icon' href='/image/pngegg (8).png' />

<meta charset="UTF-8">
<title>Page3_2</title>
<link rel="stylesheet" href="/icons/themify-icons/themify-icons.css" >
<link rel="stylesheet" href="/icons/fontello-f413f11a/css/fontello.css" >

<link rel="stylesheet" href="/css/navbar.css">
</head>
<body>

<style>
body{
 background-image: url("/image/hinh-nen-go-1.jpg");
 width: 100%;
  height: 100%;
} 
body>div{
background-color: white;
}
.an{
  position: relative; ;left: 30vw;border: 1px solid black;
	min-height: 200px;min-width: 30vw;
	float:left;
    margin-bottom: 10px;clear: both;
display: none}
.hien{
display: block;

}
</style>
<div class="con"  style="    border: 2px solid #6c6060;
    border-radius: 5px;
    padding: 20px;
    margin: 20px;
    margin-bottom:0px;
    min-height: 140px;
    display: inline-block;
    width: 93%;
    color: red;
     background-image: url('/image/pngegg (5_1).png');
    background-size:40%;
    background-position:right;
 	background-repeat: no-repeat;
    ">

<h1 class="tieude">IT</h1>
<h3 class= "tieude">Home  / <span style="color:black;">My course </span>  / Thi Cuối Kỳ / Question bank / <span style="color: black;">Editing a multiple choice question</span> </h3>


</div>
<div id="container" style="    border: 2px solid #6c6060;
    border-radius: 5px;
    padding: 20px;
    margin: 20px;
    min-height: 500px;
    display: inline-block;
    width: 93%;
    color: red;
    overflow: hidden;
    ">
<h1 style="color: red;margin: 20px;">Adding a multiple choice question</h1>
<div style="margin: 20px;padding:10px;">
<p style="color:red;"><i class="icon-down-dir" style="color: blue"></i>&nbsp;General</p>
<hr style="border-top: 1px solid #d3c7c70f;">
<p> Category               
<select id="select" name="category" style=" align-items: center;position:absolute; left:40vw;width: 200px;height: 30px;">
<option>Default</option>
<pre th:each="bank:${list}" >
     <option th:value="${bank}" th:utext="${bank}">
    </option>
    </pre>
</select> </p>
<hr style="border-top: 1px solid #d3c7c70f;">
<p>Question name
<i class="icon-attention-alt" style="color:white;background-color:red;position: absolute;left:37vw;border-radius:15px;font-size:10px;margin-top:8px;padding-top:3px;"></i>
<input type="text" id="qname" name="questionname" style="width: 300px;height: 30px;position:absolute; left:40vw;z-index: 2">
</p>
<hr style="border-top: 1px solid #d3c7c70f;">
<div >Question text
<i class="icon-attention-alt" style="color:white;background-color:red;position: absolute;left:37vw;border-radius:15px;font-size:10px;margin-top:8px;padding-top:3px;"></i>
<textarea id="qcontent" name="questioncontent" rows="15" cols="50" style="position: absolute;left:40vw;"></textarea> 
<span>
<img alt="" src="" id="imgcontent" style="width: auto;max-height: 200px;max-width:400px; float: right;position: relative;z-index: 1;" >
<input  type="file" name="imagecontent" id="imagecontent"   onchange="chooseimagecontent(this)" accept="image/jpg,image/jpeg,image/png,image/gif" style="position:relative ;left:30px;">

</span>
</div>
<br><br><br><br><br><br><br><br><br><br><br><br>
<hr style="border-top: 1px solid #d3c7c70f;">
<p><i >Answer </i>
<i class="icon-attention-alt" style="color:white;background-color:red;position: absolute;left:37vw;border-radius:15px;font-size:10px;margin-top:8px;padding-top:3px;"></i>

<input type="text" id="answer" name="answer" style="width: 300px;height: 30px;position:absolute; left:40vw;">
</p>
</div>
<div style="display: block;">
<div th:each="index : ${#numbers.sequence(1, 2)}"  style=" position: relative; left: 30vw;border: 1px solid black;
	min-height: 200px;min-width: 30vw;
	float:left;display: block;
    margin-bottom: 10px;clear: both;
 ">
<div style="padding: 30px 10px 10px 10px;">[['Choice ' + ${index}]] <input class="choice" th:name="'choice'+${index}" type="text" style="width: 300px;height: 25px;"> </div>
<div style="padding: 10px;">Grade <select>
<option>None</option>
<option>100%</option>
<option>90%</option>
<option>83.33333%</option>
<option>80%</option>
<option>75%</option>
<option>70%</option>
<option>60%</option>
<option>50%</option>
<option>40%</option>
<option>30%</option>
<option>25%</option>
<option>20%</option>
<option>16.66666%</option>
<option>10%</option>
</select> </div>
<div>
<img alt="" src="" th:id="'imgchoice'+${index}" style="width: auto;max-height: 100px;max-width:400px; float: right;position: relative;z-index: 1;" >

</div>
<div>
<input type="file" th:id="'imagechoice'+${index}" th:name="'imagechoice'+${index}" accept="image/jpg,image/jpeg,image/png,image/gif" th:onchange="'chooseimagechoice('+${index}+',this)'" >
</div>



</div>
<div class= "an" th:each="index : ${#numbers.sequence(3, 5)}"  >
<div style="padding: 30px 10px 10px 10px;">[['Choice ' + ${index}]] <input class="choice" th:name="'choice'+${index}" type="text" style="width: 300px;height: 25px;"> </div>
<div style="padding: 10px;">Grade <select>
<option>None</option>
<option>100%</option>
<option>90%</option>
<option>83.33333%</option>
<option>80%</option>
<option>70%</option>
<option>75%</option>
<option>70%</option>
<option>60%</option>
<option>50%</option>
<option>40%</option>
<option>30%</option>
<option>25%</option>
<option>20%</option>
<option>16.66666%</option>
<option>10%</option>
</select> </div>
<div>
<img alt="" src="" th:id="'imgchoice'+${index}" style="width: auto;max-height: 100px;max-width:400px; float: right;position: relative;z-index: 1;" >

</div>
<div>
<input type="file" th:id="'imagechoice'+${index}" th:name="'imagechoice'+${index}" accept="image/jpg,image/jpeg,image/png,image/gif" th:onchange="'chooseimagechoice('+${index}+',this)'" >
</div>
</div>

<div  style="position: relative;"><p style="display:block;float:left;margin-left: 30vw;margin-right: 300px;">
<button class="blank3" style="color: white; background-color: blue;position: relative;height: 35px;">BLANKS FOR 3 MORE CHOICES</button>
<br><br><br>
</p>

<div style="display:block;float:left;margin-left: 30vw;margin-right: 200px;">

<form id="sendForm" action="/addQuestionto" method="post" >
    <!--  input type="hidden" name="cate" id="cate">
	<input type="hidden" name="qn" id="qn">
	<input type="hidden" name="qc" id="qc">
	<input type="hidden" name="qc1" id="qc1">
	<input type="hidden" name="qc2" id="qc2">
	<input type="hidden" name="qc3" id="qc3">
	<input type="hidden" name="qc4" id="qc4">
	<input type="hidden" name="qc5" id="qc5">
	<input type="hidden" name="ans" id="ans"-->
    <input type="hidden" name="list" id="list">
	<button id="sendButton" style="color: white; background-color: blue;position: relative;height: 35px;">
SAVE CHANGES AND CONTINUE EDITING</button>
	
</form>


<br><br><br>
</div>
<div style="display:inline;float:left;margin-left: 30vw;margin-right: 20px;">
<button style="color: white; background-color: red;position: relative;height: 35px;">SAVE CHANGES</button>
 </div>
 <div style="display:inline;float:left;margin-right: 200px;">
 <a th:href="@{/page2_1}" > <button style="color: white; background-color: blue;position: relative;height: 35px;">CANCEL</button> </a>

 </div>
</div>
</div>


</div>
<div id="navbar">
  <ul>
    <li><a href="/home/home">Home</a></li>
    <li><a href="/page2_1">Bank</a></li>
    <li>Calendar</li>
    <li><a href="/">My Course</a></li>
    <li><a href="/page3_2">Create Question</a></li>
    <li><a href="/TurnEditing">Create Quiz</a></li>
  </ul>
</div>

<script src="/js/script.js"></script>
<script type="text/javascript">

const blank= document.querySelector('.blank3')
const an= document.querySelectorAll('.an')
function them(){
	for(const a of an){
		a.classList.toggle('hien')
	}

}
blank.addEventListener('click',them)
</script>
<script type="text/javascript">
function sendform() {
	var questionname=document.getElementById("qname").value;
	var questioncontent=document.getElementById("qcontent").value;
	var choice1=document.getElementsByName("choice1")[0].value;
	var choice2=document.getElementsByName("choice2")[0].value;
	var choice3=document.getElementsByName("choice3")[0].value;
	var choice4=document.getElementsByName("choice4")[0].value;
	var choice5=document.getElementsByName("choice5")[0].value;
	var answer= document.getElementById("answer").value;
	var category= document.getElementById("select").value.replaceAll(/&#8203;&nbsp;/g, "");
	

	
	 var list = [];
	 list.push(questionname);
	 list.push(questioncontent);
	 list.push(choice1);
	 list.push(choice2);
	 list.push(choice3);
	 list.push(choice4);
	 list.push(choice5);
	 list.push(answer);
	 list.push(category);
	
	 document.getElementById("list").value = JSON.stringify(list);
	//document.getElementById("cate").value = category;
	//document.getElementById("qn").value = questionname;
	//document.getElementById("qc").value = questioncontent;
//	document.getElementById("qc1").value = choice1;
	//document.getElementById("qc2").value = choice2;
	//document.getElementById("qc3").value = choice3;
	//document.getElementById("qc4").value = choice4;
	//document.getElementById("qc5").value = choice5;
	//document.getElementById("ans").value = answer;
	//document.getElementById("sendForm").submit();
}
document.getElementById("sendButton").addEventListener("click", sendform);
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script type="text/javascript">
	function chooseimagecontent(fileInput){
		if(fileInput.files && fileInput.files[0]){
			var reader= new FileReader()
			reader.onload= function(e){
				$('#imgcontent').attr('src',e.target.result)
			}
			reader.readAsDataURL(fileInput.files[0])
		}
	}
	function chooseimagechoice(i,fileInput){
		if(fileInput.files && fileInput.files[0]){
			var reader= new FileReader()
			reader.onload= function(e){
				$('#imgchoice'+i).attr('src',e.target.result)
			}
			reader.readAsDataURL(fileInput.files[0])
		}
	}
	
	
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("#sendForm").submit(function(event) {
            event.preventDefault(); // Ngăn chặn sự kiện gửi form mặc định
            
            // Lấy dữ liệu từ form
            var list = document.getElementById("list").value;
       		var questionid= document.getElementById("qname").value;
       		var imgcontent=  document.getElementById("imagecontent").files[0];
       		var formData = new FormData();
            formData.append('list', list); // Thêm danh sách JSON
            if (imgcontent) {
            formData.append('imgcontent', imgcontent); // Thêm tệp tin Multipart
            }
            var imgchoice1= document.getElementById("imagechoice1").files[0];
            if(imgchoice1){
            	formData.append('imgchoice1',imgchoice1);
            } 
            var imgchoice2= document.getElementById("imagechoice2").files[0];
            if(imgchoice2){
            	formData.append('imgchoice2',imgchoice2);
            }
            var imgchoice3= document.getElementById("imagechoice3").files[0];
            if(imgchoice3){
            	formData.append('imgchoice3',imgchoice3);
            }
            var imgchoice4= document.getElementById("imagechoice4").files[0];
            if(imgchoice4){
            	formData.append('imgchoice4',imgchoice4);
            }
            var imgchoice5= document.getElementById("imagechoice5").files[0];
            if(imgchoice5){
            	formData.append('imgchoice5',imgchoice5);
            }
            // Gửi yêu cầu AJAX tới máy chủ
            $.ajax({
                url: "/addQuestionto",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    // Xử lý phản hồi từ máy chủ
                    if (response.error) {
                        alert(response.error); // Hiển thị thông báo lỗi
                    } else {
                        alert("Thêm câu hỏi thành công"); // Hiển thị thông báo thành công
                        window.location.reload();
                    }
                },
                error: function() {
                     // Hiển thị thông báo lỗi khi có lỗi AJAX
                     if(document.getElementById("select").value=="Default"){
                    	 alert("chọn ngân hàng đề")
                     }
                     else if(questionid.length<=0){
                    	alert("nhập tên câu hỏi")
                    }else if(document.getElementById("qcontent").value.length<=0){
                    	alert("nhập nội dung câu hỏi")
                    }
                    else if(document.getElementById("answer").value.length<=0){
                    	alert("nhập đáp án và nhập ít nhất 2 lựa chọn ")
                    }else
                    {
                    	alert("mã câu hỏi đã tồn tại");
                    }
                }
            });
        });
    });
</script>
</body>
</html>