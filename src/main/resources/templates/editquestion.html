<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<link rel='shortcut icon' href='/image/pngegg (8).png' />

<meta charset="UTF-8">
<title>editquestion</title>
<link rel="stylesheet" href="/icons/themify-icons/themify-icons.css" ></head>
<link rel="stylesheet" href="/icons/fontello-f413f11a/css/fontello.css" ></head>

<link rel="stylesheet" href="/css/navbar.css">

<body>

<style>
body{
 background-image: url("/image/hinh-nen-go-1.jpg");
 width: 100%;
  height: 100%;
} 
body>div{
background-color: white;
}
.an{
  position: relative; ;left: 30vw;border: 1px solid black;
	min-height: 200px;min-width: 30vw;
	float:left;
    margin-bottom: 10px;clear: both;
}
.hien{
display: block;

}
</style>
<div id="navbar">
  <ul>
    <li><a href="/home/home">Home</a></li>
    <li><a href="/page2_1">Bank</a></li>
    <li>Calendar</li>
    <li><a href="/">My Course</a></li>
    <li><a href="/page3_2">Create Question</a></li>
    <li><a href="/TurnEditing">Create Quiz</a></li>
  </ul>
</div>
<script src="/js/script.js"></script>

<div class="con"  style="    border: 2px solid #6c6060;
    border-radius: 5px;
    padding: 20px;
    margin: 20px;
    margin-bottom:0px;
    min-height: 140px;
    display: inline-block;
    width: 93%;
    color: red;
    ">

<h1 class="tieude">IT</h1>
<h3 class= "tieude">Home  / <span style="color:black;">My course </span>  / Thi Cuối Kỳ / Question bank / <span style="color: black;">Editing a multiple choice question</span> </h3>


</div>
<div id="container" style="    border: 2px solid #6c6060;
    border-radius: 5px;
    padding: 20px;
    margin: 20px;
    min-height: 500px;
    display: inline-block;
    width: 93%;
    color: red;
    overflow: hidden;
    ">
<h1 style="color: red;margin: 20px;">Editing multiple choice question</h1>
<div style="margin: 20px;padding:10px;">
<p style="color:red;"><i class="ti-control-play" style="color: blue"></i>&nbsp;General</p>
<hr style="border-top: 1px solid #d3c7c70f;">
<p> Category               
<select onclick="showdata()"  id="select" name="category" style=" align-items: center;position:absolute; left:40vw;width: 200px;height: 30px;">

<option th:value="${bankgoc}" th:utext="${bankgoc}">Default</option>
<pre th:each="bank:${list}" >
     <option th:value="${bank}" th:utext="${bank}" >
    </option>
    </pre>
</select> </p>
<hr style="border-top: 1px solid #d3c7c70f;">
<p>Question name
<i class="icon-attention-alt" style="color:white;background-color:red;position: absolute;left:37vw;border-radius:15px;font-size:10px;margin-top:8px;padding-top:3px;"></i>
<input onchange="showdata()" readonly type="text" id="qname" name="questionname" th:value="${ques.getQuestionID()}" style="width: 300px;height: 30px;position:absolute; left:40vw;">
<input type="hidden" id="oldid" th:value="${ques.getQuestionID()}" >
</p>
<hr style="border-top: 1px solid #d3c7c70f;">
<div >Question text
<i class="icon-attention-alt" style="color:white;background-color:red;position: absolute;left:37vw;border-radius:15px;font-size:10px;margin-top:8px;padding-top:3px;"></i>
<textarea onchange="showdata()"   id="qcontent" name="questioncontent" th:text="${ques.getQuestionContent()}" rows="15" cols="50" style="position: absolute;left:40vw;"></textarea> 
<span>

<img onchange="showdata()" alt="Example Image" th:src="'data:image/jpeg;base64,'+${imagecontent}" id="imgcontent" style="width: auto;max-height: 200px;max-width:400px; float: right;position: relative;z-index: 1;" >
<input  type="file" name="imagecontent" id="imagecontent" onclick="showdata()"  onchange="chooseimagecontent(this)" accept="image/jpg,image/jpeg,image/png,image/gif" style="position:relative ;left:30px;">

</span>
</div>
<br><br><br><br><br><br><br><br><br><br><br><br>
<hr style="border-top: 1px solid #d3c7c70f;">
<p><i>Answer </i>
<i class="icon-attention-alt" style="color:white;background-color:red;position: absolute;left:37vw;border-radius:15px;font-size:10px;margin-top:8px;padding-top:3px;"></i>
<input  onchange="showdata()"   th:value="${ques.getAnswer.charAt(ques.getAnswer.length-1)}" type="text" id="answer" name="answer" style="width: 300px;height: 30px;position:absolute; left:40vw;">
</p>
</div>
<div style="display: block;">
<div onchange="showdata()"  th:each="choice,index : ${ques.getListChoice()}"  style=" position: relative ;left: 30vw;border: 1px solid black;
	min-height: 200px;min-width: 30vw;
	float:left;display: block;
    margin-bottom: 10px;clear: both;
 ">
<div style="padding: 30px 10px 10px 10px;">[['Choice ' + ${index.count}]] <input  class="choice" th:name="'choice'+${index.count}" type="text" style="width: 300px;height: 25px;" th:value="${choice}"> </div>
<div style="padding: 10px;">Grade <select onchange="sendform">
<option>None</option>
<option>100%</option>
<option>90%</option>
<option>83.33333%</option>
<option>80%</option>
<option>70%</option>
<option>75%</option>
</select> </div>

<div>
<img onchange="showdata()" alt="" th:src="'data:image/jpeg;base64,'+${#vars['imagechoice' + index.count]}" th:id="'imgchoice'+${index.count}" style="width: auto;max-height: 100px;max-width:400px; float: right;position: relative;z-index: 1;" >

</div>
<div>
<input type="file" th:id="'imagechoice'+${index.count}" th:name="'imagechoice'+${index.count}"  accept="image/jpg,image/jpeg,image/png,image/gif" onclick="showdata()" th:onchange="'chooseimagechoice('+${index.count}+',this)'" >
</div>


</div>


<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>


</div>

</div>
<div style="display:block;float:left;margin-left: 35vw;margin-right: 20px;position: relative;bottom: 10px;">
<form id="sendForm" action="/editquestion" method="post" >
 <input type="hidden" name="list" id="list">
 <input type="hidden" name="bankgoc" id="bankgoc" th:value="${bankgoc}">

<button id="sendButton" style="color: white; background-color: red;position: relative;height: 35px;">SAVE CHANGES</button>
</form>
 </div>
 <div style="display:inline;float:left;margin-right: 200px;position: relative;bottom: 10px;">
 <a th:href="@{/page2_1}" > <button style="color: white; background-color: blue;position: relative;height: 35px;">CANCEL</button> </a>

 </div>
<script type="text/javascript">
	function chooseimagecontent(fileInput){
		if(fileInput.files && fileInput.files[0]){
			var reader= new FileReader()
			reader.onload= function(e){
				$('#imgcontent').attr('src',e.target.result)
			}
			reader.readAsDataURL(fileInput.files[0])
		}
	}
	function chooseimagechoice(i,fileInput){
		if(fileInput.files && fileInput.files[0]){
			var reader= new FileReader()
			reader.onload= function(e){
				$('#imgchoice'+i).attr('src',e.target.result)
			}
			reader.readAsDataURL(fileInput.files[0])
		}
	}
	
	
</script>
<script type="text/javascript">

const blank= document.querySelector('.blank3')
const an= document.querySelectorAll('.an')
function them(){
	for(const a of an){
		a.classList.toggle('hien')
	}

}

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
function showdata(){
	var questionname=document.getElementById("qname").value;
	var questioncontent=document.getElementById("qcontent").value;
	var choice1=document.getElementsByName("choice1")[0].value;
	var choice2=document.getElementsByName("choice2")[0].value;
	

	var answer= document.getElementById("answer").value;
	var category= document.getElementById("select").value.replaceAll(/&#8203;&nbsp;/g, "");
	 var list = [];
	 
	  // Gửi form
	  
	 list.push(questionname);
	 list.push(questioncontent);
	 
	 if(choice1){
		 list.push(choice1);
	 }
	 if(choice2){
		 list.push(choice2);
	 }
	 if(document.getElementsByName("choice3").length>0){
		 var choice3=document.getElementsByName("choice3")[0].value;
		 list.push(choice3);
	 }else{
		 list.push("")
	 }
	 if(document.getElementsByName("choice4").length>0){
		 var choice4=document.getElementsByName("choice4")[0].value;
		 list.push(choice4);
	 }else{
		 list.push("")
	 }
	 if(document.getElementsByName("choice5").length>0){
		 var choice5=document.getElementsByName("choice5")[0].value;
		 list.push(choice5);
	 }else{
		 list.push("")
	 }
	 list.push(answer);
	 list.push(category);
	 list.push(document.getElementById("oldid").value)
	 document.getElementById("list").value = JSON.stringify(list);
	var questionname=document.getElementById("qname").value;
	
}
</script>
<script type="text/javascript">

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("#sendForm").submit(function(event) {
            event.preventDefault(); // Ngăn chặn sự kiện gửi form mặc định
            
            // Lấy dữ liệu từ form
            var list = document.getElementById("list").value;
       		var questionid= document.getElementById("qname").value;
       		console.log(list)
       		var bankgoc=document.getElementById("bankgoc").value
       		
       		var formData = new FormData();
       		formData.append('bankgoc',bankgoc)
            formData.append('list', list); // Thêm danh sách JSON
       		var imgcontent=  document.getElementById("imagecontent").files[0];
       		if (imgcontent) {
                formData.append('imgcontent', imgcontent); // Thêm tệp tin Multipart
                }
       		if(document.getElementById("imagechoice1")){
       			var imgchoice1=  document.getElementById("imagechoice1").files[0];
           		if (imgchoice1) {
                    formData.append('imgchoice1', imgchoice1); // Thêm tệp tin Multipart
                    }
       		}
       		if(document.getElementById("imagechoice2")){
       			var imgchoice2=  document.getElementById("imagechoice2").files[0];
           		if (imgchoice2) {
                    formData.append('imgchoice2', imgchoice2); // Thêm tệp tin Multipart
                    }
       		}
       		if(document.getElementById("imagechoice3")){
       			var imgchoice3=  document.getElementById("imagechoice3").files[0];
           		if (imgchoice3) {
                    formData.append('imgchoice3', imgchoice3); // Thêm tệp tin Multipart
                    }
       		}
       		if(document.getElementById("imagechoice4")){
       			var imgchoice4=  document.getElementById("imagechoice4").files[0];
           		if (imgchoice4) {
                    formData.append('imgchoice4', imgchoice4); // Thêm tệp tin Multipart
                    }
       		}
       		if(document.getElementById("imagechoice5")){
       			var imgchoice5=  document.getElementById("imagechoice5").files[0];
           		if (imgchoice5) {
                    formData.append('imgchoice5', imgchoice5); // Thêm tệp tin Multipart
                    }
       		}
       		//var imgcontent=   $("#imgcontent").attr("src");
          //  if (imgcontent) {
           // formData.append('imgcontent', imgcontent); // Thêm tệp tin Multipart
           // }
            
            // Gửi yêu cầu AJAX tới máy chủ
            $.ajax({
                url: "/editquestion",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    // Xử lý phản hồi từ máy chủ
                    if (response.error) {
                        alert(response.error); // Hiển thị thông báo lỗi
                    } else {
                        alert("sửa câu hỏi thành công"); // Hiển thị thông báo thành công
                        window.location.reload();
                    }
                },
                error: function() {
                     // Hiển thị thông báo lỗi khi có lỗi AJAX
                	 if(document.getElementById("select").value=="Default"){
                    	 alert("chọn ngân hàng đề")
                     }
                     else if(questionid.length<=0){
                    	alert("nhập tên câu hỏi")
                    }else if(document.getElementById("qcontent").value.length<=0){
                    	alert("nhập nội dung câu hỏi")
                    }
                    else if(document.getElementById("answer").value.length<=0){
                    	alert("nhập đáp án và nhập ít nhất 2 lựa chọn ")
                    }else
                    {
                    	alert("đã sửa");
                    }
                }
            });
        });
    });
</script>
</body>
</html>