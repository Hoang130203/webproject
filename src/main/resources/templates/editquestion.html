<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>editquestion</title>
<link rel="stylesheet" href="/icons/themify-icons/themify-icons.css" ></head>
<body>

<style>

.an{
  position: relative; ;left: 30vw;border: 1px solid black;
	min-height: 200px;min-width: 30vw;
	float:left;
    margin-bottom: 10px;clear: both;
}
.hien{
display: block;

}
</style>
<div class="con"  style="    border: 2px solid #6c6060;
    border-radius: 5px;
    padding: 20px;
    margin: 20px;
    margin-bottom:0px;
    min-height: 140px;
    display: inline-block;
    width: 93%;
    color: red;
    ">

<h1 class="tieude">IT</h1>
<h3 class= "tieude">Home  / <span style="color:black;">My course </span>  / Thi Cuối Kỳ / Question bank / <span style="color: black;">Editing a multiple choice question</span> </h3>


</div>
<div id="container" style="    border: 2px solid #6c6060;
    border-radius: 5px;
    padding: 20px;
    margin: 20px;
    min-height: 500px;
    display: inline-block;
    width: 93%;
    color: red;
    overflow: hidden;
    ">
<h1 style="color: red;margin: 20px;">Adding a multiple choice question</h1>
<div style="margin: 20px;padding:10px;">
<p style="color:red;"><i class="ti-control-play" style="color: blue"></i>&nbsp;General</p>
<hr style="border-top: 1px solid #d3c7c70f;">
<p> Category               
<select onclick="showdata()"  id="select" name="category" style=" align-items: center;position:absolute; left:40vw;width: 200px;height: 30px;">

<option th:value="${bankgoc}" th:utext="${bankgoc}">Default</option>
<pre th:each="bank:${list}" >
     <option th:value="${bank}" th:utext="${bank}" >
    </option>
    </pre>
</select> </p>
<hr style="border-top: 1px solid #d3c7c70f;">
<p>Question name
<input onchange="showdata()" readonly type="text" id="qname" name="questionname" th:value="${ques.getQuestionID()}" style="width: 300px;height: 30px;position:absolute; left:40vw;">
<input type="hidden" id="oldid" th:value="${ques.getQuestionID()}" >
</p>
<hr style="border-top: 1px solid #d3c7c70f;">
<div >Question text
<textarea onchange="showdata()"   id="qcontent" name="questioncontent" th:text="${ques.getQuestionContent()}" rows="15" cols="50" style="position: absolute;left:40vw;"></textarea> 
</div>
<br><br><br><br><br><br><br><br><br><br><br><br>
<hr style="border-top: 1px solid #d3c7c70f;">
<p><i>Answer </i>
<input  onchange="showdata()"   th:value="${ques.getAnswer.charAt(ques.getAnswer.length-1)}" type="text" id="answer" name="answer" style="width: 300px;height: 30px;position:absolute; left:40vw;">
</p>
</div>
<div style="display: block;">
<div onchange="showdata()"  th:each="choice,index : ${ques.getListChoice()}"  style=" position: relative; ;left: 30vw;border: 1px solid black;
	min-height: 200px;min-width: 30vw;
	float:left;display: block;
    margin-bottom: 10px;clear: both;
 ">
<div style="padding: 30px 10px 10px 10px;">[['Choice ' + ${index.count}]] <input  class="choice" th:name="'choice'+${index.count}" type="text" style="width: 300px;height: 25px;" th:value="${choice}"> </div>
<div style="padding: 10px;">Grade <select onchange="sendform">
<option>None</option>
<option>100%</option>
<option>90%</option>
<option>83.33333%</option>
<option>80%</option>
<option>70%</option>
<option>75%</option>
</select> </div>
</div>
<!--  div class= "an" th:each="index : ${#numbers.sequence(3, 5)}"  >
<div style="padding: 30px 10px 10px 10px;">[['Choice ' + ${index}]] <input class="choice" th:name="'choice'+${index}" type="text" style="width: 300px;height: 25px;"> </div>
<div style="padding: 10px;">Grade <select>
<option>None</option>
<option>100%</option>
<option>90%</option>
<option>83.33333%</option>
<option>80%</option>
<option>70%</option>
<option>75%</option>
</select> </div>
</div-->

<div  style="position: relative;"><p style="display:block;float:left;margin-left: 30vw;margin-right: 300px;">

</p>

<div style="display:block;float:left;margin-left: 30vw;margin-right: 200px;">


    <!--  input type="hidden" name="cate" id="cate">
	<input type="hidden" name="qn" id="qn">
	<input type="hidden" name="qc" id="qc">
	<input type="hidden" name="qc1" id="qc1">
	<input type="hidden" name="qc2" id="qc2">
	<input type="hidden" name="qc3" id="qc3">
	<input type="hidden" name="qc4" id="qc4">
	<input type="hidden" name="qc5" id="qc5">
	<input type="hidden" name="ans" id="ans"-->




<br><br><br><br><br><br><br><br><br><br><br><br>
</div>
<div style="display:inline;float:left;margin-left: 30vw;margin-right: 20px;">
<form id="sendForm" action="/editquestion" method="post" >
 <input type="hidden" name="list" id="list">
 <input type="hidden" name="bankgoc" id="bankgoc" th:value="${bankgoc}">
<button id="sendButton" style="color: white; background-color: red;position: relative;height: 35px;">SAVE CHANGES</button>
</form>
 </div>
 <div style="display:inline;float:left;margin-right: 200px;">
 <a th:href="@{/page2_1}" > <button style="color: white; background-color: blue;position: relative;height: 35px;">CANCEL</button> </a>

 </div>
</div>
</div>


</div>

<script type="text/javascript">

const blank= document.querySelector('.blank3')
const an= document.querySelectorAll('.an')
function them(){
	for(const a of an){
		a.classList.toggle('hien')
	}

}

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
function showdata(){
	var questionname=document.getElementById("qname").value;
	var questioncontent=document.getElementById("qcontent").value;
	var choice1=document.getElementsByName("choice1")[0].value;
	var choice2=document.getElementsByName("choice2")[0].value;
	

	var answer= document.getElementById("answer").value;
	var category= document.getElementById("select").value.replaceAll(/&#8203;&nbsp;/g, "");
	 var list = [];
	 
	  // Gửi form
	  
	 list.push(questionname);
	 list.push(questioncontent);
	 
	 if(choice1){
		 list.push(choice1);
	 }
	 if(choice2){
		 list.push(choice2);
	 }
	 if(document.getElementsByName("choice3").length>0){
		 var choice3=document.getElementsByName("choice3")[0].value;
		 list.push(choice3);
	 }else{
		 list.push("")
	 }
	 if(document.getElementsByName("choice4").length>0){
		 var choice4=document.getElementsByName("choice4")[0].value;
		 list.push(choice4);
	 }else{
		 list.push("")
	 }
	 if(document.getElementsByName("choice5").length>0){
		 var choice5=document.getElementsByName("choice5")[0].value;
		 list.push(choice5);
	 }else{
		 list.push("")
	 }
	 list.push(answer);
	 list.push(category);
	 list.push(document.getElementById("oldid").value)
	 document.getElementById("list").value = JSON.stringify(list);
	var questionname=document.getElementById("qname").value;
	
}
</script>
<script type="text/javascript">

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("#sendForm").submit(function(event) {
            event.preventDefault(); // Ngăn chặn sự kiện gửi form mặc định
            
            // Lấy dữ liệu từ form
            var list = document.getElementById("list").value;
       		var questionid= document.getElementById("qname").value;
       		console.log(list)
       		var bankgoc=document.getElementById("bankgoc").value
            // Gửi yêu cầu AJAX tới máy chủ
            $.ajax({
                url: "/editquestion",
                type: "POST",
                data: { list:list ,bankgoc:bankgoc},
                success: function(response) {
                    // Xử lý phản hồi từ máy chủ
                    if (response.error) {
                        alert(response.error); // Hiển thị thông báo lỗi
                    } else {
                        alert("sửa câu hỏi thành công"); // Hiển thị thông báo thành công
                        window.location.reload();
                    }
                },
                error: function() {
                     // Hiển thị thông báo lỗi khi có lỗi AJAX
                	 if(document.getElementById("select").value=="Default"){
                    	 alert("chọn ngân hàng đề")
                     }
                     else if(questionid.length<=0){
                    	alert("nhập tên câu hỏi")
                    }else if(document.getElementById("qcontent").value.length<=0){
                    	alert("nhập nội dung câu hỏi")
                    }
                    else if(document.getElementById("answer").value.length<=0){
                    	alert("nhập đáp án và nhập ít nhất 2 lựa chọn ")
                    }else
                    {
                    	alert("mã câu hỏi đã tồn tại");
                    }
                }
            });
        });
    });
</script>
</body>
</html>